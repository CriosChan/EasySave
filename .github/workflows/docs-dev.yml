name: Generate and push docs on dev

on:
  pull_request: 
  push:
    branches:
      - dev

permissions:
  contents: write  # Required for push

jobs:
  build-and-push-docs:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # For Git history

      - name: Setup .NET  # DocFX requires .NET
        uses: actions/setup-dotnet@v5
        with:
          global-json-file: global.json

      - name: Display active .NET version
        run: dotnet --version  # Verify 10.x active [web:35]

      - name: Install docfx
        run: dotnet tool install --global docfx --version 2.78.3

      - name: Display tool list
        run: dotnet tool list --global
        
      - name: Display docfx version
        run: docfx -v
        
      - name: Build docfx
        run: docf

      - name: Create local docs branch if missing
        run: |
          git checkout --orphan docs-temp
          git rm -rf .

      - name: Copy generated documentation
        run: |
          cp -r _site/* docs-temp/
          cd docs-temp
          git a
